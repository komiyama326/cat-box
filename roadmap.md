project名：Cat-box

【フェーズ1】 プラットフォームMVPのプロトタイピング (コアメカニズムの構築)

目的: 「サーバーからアプリをダウンロードして起動する」というプラットフォームのコアメカニズムを、セキュリティを考慮した上で確立すること。

ステップ 4: サーバーサイドAPIの設計と最小実装

4-1. プロジェクトセットアップ: FastAPI と uvicorn をインストールし、サーバーサイド用の新しいGitリポジトリを作成する。

4-2. データモデルの定義 (Pydantic): アプリ情報（ID, 名前, バージョン, 説明, アイコンURL, ダウンロードURL）を表現するデータ構造をPydanticモデルで定義する。

4-3. ダミーエンドポイントの実装: /api/v1/apps エンドポイントを作成し、4-2で定義したモデルに従ったハードコードされたJSONデータを返すようにする。

4-4. CORS設定: ローカル開発中のランチャーからAPIにアクセスできるよう、FastAPIにCORS (Cross-Origin Resource Sharing) ミドルウェアを設定する。

4-5. PaaSへのデプロイ: 作成した最小APIをRender.com等にデプロイし、公開URLを取得する。

ステップ 5: プラットフォーム・ランチャーの基本骨格開発

5-1. プロジェクトセットアップ: ランチャー用の新しいGitリポジトリとPythonプロジェクトを作成し、PySide6とrequestsをインストールする。

5-2. APIクライアントクラスの実装: ステップ4のAPIと通信するためのクラスを作成する。get\_app\_list()のようなメソッドを持つ。

5-3. メインウィンドウのUI設計: アプリ一覧を表示するリストウィジェットと、選択したアプリの詳細を表示するエリア、ログ出力用のテキストエリアなどを配置する。

5-4. 非同期API通信の実装:

ランチャー起動時にUIが固まらないよう、別スレッド (QThread) でAPI通信を行う。

APIから取得したアプリ一覧データをメインスレッドにシグナルで渡し、UIを更新する。

5-5. プロセス起動機能の実装: subprocess.Popenを使い、ローカルにあるシフトアプリの.exeを起動する機能を「起動」ボタンに紐付ける。

ステップ 6: セキュアなファイル配布・実行システムの確立

6-1. クラウドストレージの準備: Amazon S3 (またはGCS) でバケットを作成し、公開アクセス設定を行う。

6-2. アプリパッケージの作成: シフトアプリのソースコードと依存関係をまとめたzipファイルを作成し、S3に手動でアップロードする。

6-3. APIの更新: ダミーAPIが返すJSONに、S3上のzipファイルへの正しいダウンロードURLを含めるように修正する。

6-4. ランチャーへのダウンロード機能実装: requestsを使い、URLからzipファイルをメモリ上または一時ファイルとしてダウンロードする機能を実装する。進捗表示も行う。

6-5. アプリケーションデータディレクトリの管理: os.path.join(os.getenv('APPDATA'), 'YourPlatformName', 'apps') のような、アプリを保存するための専用ディレクトリを管理するロジックを実装する。

6-6. Zip展開と実行ロジック: ダウンロードしたzipファイルを、アプリごとのサブディレクトリ（例: .../apps/shift-app-v1.0.0/）に展開する。展開後、その中にあるメインスクリプト（例: main.py）を、ランチャーに同梱したPythonで実行する。

6-7. サーバーサイド検証パイプラインの構築:

【リスク対策】 アップロードされたzipファイルを処理するFastAPIのエンドポイントを（まだ手動トリガーで良いので）作成する。

そのエンドポイント内で、ファイルサイズ、ファイル数、拡張子チェックを行うロジックを実装する。

サーバーにClamAVをインストールし、Pythonから呼び出してウイルススキャンを実行する機能を組み込む。

【フェーズ2】 プラットフォームの法務・制度的基盤構築と機能拡張

目的: ユーザー認証を導入し、プラットフォームを法的に保護するための規約を整備。エコシステムの基盤となる機能を実装する。

ステップ 7: 法務・制度的基盤の整備

7-1. 専門家への相談: 【最重要】 ITに詳しい弁護士を探し、プラットフォームの構想を説明して相談する。

7-2. 利用規約の作成: 専門家の監修のもと、禁止事項、権利関係、免責事項、違反時の措置を明記した利用規約を作成する。

7-3. プライバシーポリシーの作成: 収集するユーザーデータ（メールアドレス等）とその利用目的を明記したプライバシーポリシーを作成する。

7-4. 著作権侵害対応プロセスの確立: DMCAテイクダウンノーティスを受け付けるためのメールアドレスまたはWebフォームを準備し、社内の対応フローを文書化する。

ステップ 8: ユーザー認証とデータベースの導入

8-1. データベースの選定とセットアップ: PostgreSQLを選定し、クラウドデータベースサービス（Supabase, Neon, AWS RDSなど）でインスタンスをセットアップする。

8-2. サーバーサイドORMの導入: SQLAlchemyとAlembic（マイグレーションツール）を導入し、UserテーブルとAppテーブルのモデルを定義する。

8-3. 認証ロジックの実装:

ユーザー登録API（パスワードはpasslibでハッシュ化）、ログインAPI（成功時にJWTを発行）、ユーザー情報取得API（JWTで保護）を実装する。

8-4. ランチャーへの認証機能実装: ログイン/新規登録画面を作成し、成功時にJWTを安全な場所（keyringライブラリなど）に保存し、以降のAPIリクエストに付与するロジックを実装する。

ステップ 9: 開発者向け投稿・管理機能

9-1. Webフロントエンドのセットアップ: サーバーサイドにJinja2テンプレートエンジンを導入し、Webページを提供できるようにする。

9-2. 開発者向けWeb UIの作成: ログイン機能、マイページ、アプリ一覧、新規アプリ登録/編集フォーム、zipファイルアップロード機能を実装する。

9-3. アップロード処理の統合: アップロードされたzipファイルが、ステップ6-7の検証パイプラインを通り、「レビュー待ち」ステータスでDBに登録されるようにする。

9-4. 管理者向けレビュー機能:

【リスク対策】 特定の管理者ユーザーのみがアクセスできる、レビュー待ちアプリの一覧ページを作成する。

アプリ情報を確認し、「承認」「却下」ボタンでステータスを変更できる機能を実装する。承認されたアプリのみが、一般ユーザー向けのAPIで返されるようにする。

ステップ 10: Webサイト連携とUXの強化

10-1. カスタムURLスキームのOS登録: ランチャーのInno Setupスクリプトを更新し、インストール時にshift-app://のようなURLスキームをWindowsのレジストリに登録する処理を追加する。

10-2. ランチャーの引数処理: ランチャー起動時にコマンドライン引数 (sys.argv) をチェックし、URLスキーム経由で渡された情報（例: app\_id）を解釈するロジックを実装する。

10-3. Webサイトへの起動ボタン設置: Webサイトのアプリ紹介ページに、「ランチャーで起動」ボタン（実体は shift-app://launch?app\_id=... のリンク）を設置する。

