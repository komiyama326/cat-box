# Cat-box セキュリティ設計ガイドライン

## 基本原則
本プロジェクトでは、AIによるコード生成を積極的に活用するが、生成されたコードは「下書き」として扱う。すべてのコード、特にセキュリティに関わる部分は、人間の開発者が以下の原則に基づいてレビューし、修正を行う責任を負う。

---

### 1. 秘匿情報はバックエンドに限定する (最重要)

**原則:** APIキー、データベースのパスワード、外部サービスの認証情報などの秘匿情報は、**いかなる理由があってもフロントエンド（ランチャー、WebサイトのJavaScript）のコードに直接記述しない。**

- **実装方針:**
  - すべての秘匿情報は `.env` ファイルに記述する。
  - `.env` ファイルは `.gitignore` に追加し、Gitリポジトリに含めない。
  - 秘匿情報はサーバーサイド（FastAPI）のコード内でのみ環境変数として読み込み、使用する。
  - フロントエンドには、APIのエンドポイントURLなど、公開されても問題ない情報のみを保持する。

---

### 2. リソースへのアクセス制御を徹底する

**原則:** ユーザーがアップロードしたファイル（アプリのzipなど）や、ユーザー固有の情報に対しては、必ずバックエンドでアクセス権の検証を行う。URLが推測可能であっても、権限のないユーザーがアクセスできないように設計する。

- **実装方針:**
  - **ファイルストレージ (S3等):**
    - バケットやオブジェクトは原則として**非公開（Private）**に設定する。
    - ファイルへのアクセスには、バックエンドで認証・認可を行った上で生成される、有効期限付きの**署名付きURL (Signed URL)** を用いる。
  - **APIエンドポイント:**
    - ログインが必須なAPIでは、必ず認証トークン（JWTなど）を検証する。
    - 「ユーザーAがユーザーBの情報を取得・更新する」といった操作を防ぐため、リクエストされたリソースの所有者と、リクエスト元のユーザーが一致するかをバックエンドで必ず検証する。

---

### 3. 外部サービス (BaaS等) の利用は慎重に

**原則:** Firebase/SupabaseのようなBaaSを利用する場合、そのサービスのセキュリティ機能を最大限に活用し、設定の不備による情報漏洩を防ぐ。（※本プロジェクトでは自前のバックエンドを構築しているが、思想は同様に適用する）

- **実装方針（BaaS利用時）:**
  - **Row Level Security (RLS):** データベースの行単位でアクセス制御を厳格に設定する。
  - **ストレージのセキュリティルール:** ファイルへのアクセス権を詳細に設定する。
- **実装方針（自前バックエンド）:**
  - 上記「2. リソースへのアクセス制御を徹底する」のAPIエンドポイントにおける権限検証ロジックを、BaaSのRLSと同等の厳格さで実装する。